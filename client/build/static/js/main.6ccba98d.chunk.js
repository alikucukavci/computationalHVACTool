(window.webpackJsonpclient=window.webpackJsonpclient||[]).push([[0],{58:function(e,t,a){e.exports=a(94)},63:function(e,t,a){},65:function(e,t,a){},94:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),o=a(25),s=a.n(o),c=(a(63),a(12)),l=(a(64),a(65),a(6)),i=a(97),m=a(99),u=a(96),p=a(8),d=a.n(p);function h(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}var f=function(e){var t=Object(r.useState)({username:"",password:"",message:""}),a=Object(c.a)(t,2),o=a[0],s=a[1],p=function(e){var t=e.target,a=t.name,r=t.value;s(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?h(a,!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):h(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},o,Object(l.a)({},a,r)))};return n.a.createElement(n.a.Fragment,null,n.a.createElement("h2",null,"Signup"),n.a.createElement(i.a,{onSubmit:function(t){t.preventDefault(),function(e,t){return d.a.post("/api/auth/signup",{username:e,password:t}).then((function(e){return e.data})).catch((function(e){return e.response.data}))}(o.username,o.password).then((function(t){t.message?s({message:t.message,username:"",password:""}):(e.setUser(t),e.history.push("/projects"))}))}},n.a.createElement(i.a.Group,null,n.a.createElement(i.a.Label,{htmlFor:"username"},"Username: "),n.a.createElement(i.a.Control,{type:"text",name:"username",value:o.username,onChange:p,id:"username"})),n.a.createElement(i.a.Group,null,n.a.createElement(i.a.Label,{htmlFor:"password"},"Password: "),n.a.createElement(i.a.Control,{type:"password",name:"password",value:o.password,onChange:p,id:"password"})),o.message&&n.a.createElement(m.a,{variant:"danger"},o.message),n.a.createElement(u.a,{type:"submit"},"Signup")))};function j(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}var b=function(e){var t=Object(r.useState)({username:"",password:"",message:""}),a=Object(c.a)(t,2),o=a[0],s=a[1],p=function(e){var t=e.target,a=t.name,r=t.value;s(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?j(a,!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):j(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},o,Object(l.a)({},a,r)))};return n.a.createElement(n.a.Fragment,null,n.a.createElement("h2",null,"Login"),n.a.createElement(i.a,{onSubmit:function(t){t.preventDefault(),function(e,t){return d.a.post("/api/auth/login",{username:e,password:t}).then((function(e){return e.data})).catch((function(e){return e.response.data}))}(o.username,o.password).then((function(t){t.message?s({message:t.message,username:"",password:""}):(e.setUser(t),e.history.push("/projects"))}))}},n.a.createElement(i.a.Group,null,n.a.createElement(i.a.Label,{htmlFor:"username"},"Username: "),n.a.createElement(i.a.Control,{type:"text",name:"username",value:o.username,onChange:p,id:"username"})),n.a.createElement(i.a.Group,null,n.a.createElement(i.a.Label,{htmlFor:"password"},"Password: "),n.a.createElement(i.a.Control,{type:"password",name:"password",value:o.password,onChange:p,id:"password"})),o.message&&n.a.createElement(m.a,{variant:"danger"},o.message),n.a.createElement(u.a,{type:"submit"},"Login")))},g=a(16),E=a(14),w=a(98),v=function(e){d.a.delete("/api/auth/logout").then((function(e){return e.data})).catch((function(e){return e.response.data})).then((function(){e.setUser(null)}))},O=function(e){return n.a.createElement(w.a,{className:"nav justify-content-end fixed-top",bg:"primary"},e.user&&n.a.createElement(w.a.Brand,null,"Welcome, ",e.user.username),n.a.createElement(w.a.Brand,null,n.a.createElement(E.b,{to:"/"},"Home")),e.user?n.a.createElement(n.a.Fragment,null,n.a.createElement(w.a.Brand,null,n.a.createElement(E.b,{to:"/projects"},"Projects")),n.a.createElement(w.a.Brand,null,n.a.createElement(E.b,{to:"/",onClick:function(){return v(e)}},"Logout"))):n.a.createElement(n.a.Fragment,null,n.a.createElement(w.a.Brand,null,n.a.createElement(E.b,{to:"/signup"},"Signup")),n.a.createElement(w.a.Brand,null,n.a.createElement(E.b,{to:"/login"},"Login"))))},y=function(e){return n.a.createElement("div",{className:"col-2 projectBar"},n.a.createElement("h5",null,"Projects"),e.projects.map((function(t){return n.a.createElement("div",{onClick:function(){e.setOneProject(t),e.setDisplay("ThreeJS")}},t.title)})),n.a.createElement("button",{onClick:function(){return e.setDisplay("Form")},className:"btn btn-dark"},"New"))},N=a(36),P=a.n(N);function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}var S=function(e){(new FileReader).onload=function(t){e.setFile(JSON.parse(t.target.result))};var t=function(t){var a=t.target,r=a.name,n=a.value;e.setcreateNewProject(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(a,!0).forEach((function(t){Object(l.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e.createNewProject,Object(l.a)({},r,n)))};return n.a.createElement("div",null,n.a.createElement("h2",null,"Add task: "),n.a.createElement(i.a,{onSubmit:function(t){t.preventDefault(),d.a.post("/api/projects",{title:e.createNewProject.title,description:e.createNewProject.description,owner:e.user._id}).then((function(t){console.log(t.data),e.setDisplay("newProject")})).catch((function(e){console.log(e)})),d.a.get("/api/projects/".concat(e.user._id)).then((function(t){e.setProjects(t.data),console.log(t.data)}))}},n.a.createElement(i.a.Group,null,n.a.createElement(i.a.Label,null,"Title:"),n.a.createElement(i.a.Control,{type:"text",name:"title",value:e.createNewProject.title,onChange:t})),n.a.createElement(i.a.Group,null,n.a.createElement(i.a.Label,null,"Description:"),n.a.createElement(i.a.Control,{type:"text",name:"description",value:e.description,onChange:t})),n.a.createElement(u.a,{type:"submit"},"Add")))},F=function(e){var t=new FileReader;return t.onload=function(t){var a=JSON.parse(t.target.result);a.rooms=a.rooms.map((function(e,t){return e.id=t,e})),e.setFile(a),d.a.put("/api/projects/".concat(e.project._id),{file:a}).then((function(t){e.setOneProject(t.data),e.setDisplay("ThreeJS")}))},n.a.createElement("div",{className:"upload-page"},n.a.createElement(i.a.Group,null,n.a.createElement("div",{className:"files"},n.a.createElement(P.a,{className:"files-dropzone",onChange:function(e){t.readAsText(e[0])},onError:function(e){return console.log(e)},accepts:[".json"],multiple:!0,maxFiles:3,maxFileSize:1e7,minFileSize:0,clickable:!0},"Drop files here or click to upload"))),"    ")},D=a(20),C=a(55),U=a(23),x=a(21),k=a(22),L=a(5),H=a(56),I=a.n(H),z=a(57),B=function(e){function t(){var e,a;Object(D.a)(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(a=Object(U.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(n)))).state={popup:!1,id:"",roomName:"",roomNumber:0,roomVolume:0,roomArea:0,roomAHU:0,roomAirflow:0,roomID:""},a.perc2color=function(e){var t,a;return e<50?(t=255,a=Math.round(5.1*e)):(a=255,t=Math.round(510-5.1*e)),"#"+("000000"+(65536*t+256*a+0).toString(16)).slice(-6)},a.closePopup=function(e){a.setState({popup:!a.state.popup})},a.handleChange=function(e){var t=e.target,r=t.name,n=t.value;a.setState(Object(l.a)({},r,n))},a.start=function(){a.frameId||(a.frameId=requestAnimationFrame(a.animate))},a.stop=function(){cancelAnimationFrame(a.frameId)},a.animate=function(){a.renderScene(),a.frameId=window.requestAnimationFrame(a.animate)},a.renderScene=function(){a.renderer.render(a.scene,a.camera)},a.handleSubmit=function(e){e.preventDefault();var t=a.state,r=t.roomAHU,n=t.roomAirflow,o=t.roomID;console.log(a.props.project),d.a.put("/api/projects/".concat(a.props.project._id),{roomAHU:r,roomAirflow:n,roomID:o}).then((function(e){a.props.setOneProject(e.data);var t=a.props.projects.map((function(t){return t._id===e.data._id?e.data:t}));a.props.setProjects(t)}))},a}return Object(k.a)(t,e),Object(C.a)(t,[{key:"componentDidUpdate",value:function(){var e=this;this.props.jsonFile.rooms.forEach((function(t,a){var r=e.scene.children.find((function(e){return e.roomID===t.id}));r.AHU=t.roomAHU,r.Airflow=t.roomAirflow;var n=new L.Color(e.perc2color(r.Airflow));r.material.color=n}))}},{key:"componentDidMount",value:function(){var e=this;this.scene=new L.Scene,this.camera=new L.PerspectiveCamera(20,window.innerWidth/window.innerHeight,20,1e3),this.camera.position.z=100,this.renderer=new L.WebGLRenderer({antialias:!0}),this.renderer.setClearColor("#000000"),this.renderer.setSize(window.innerWidth,window.innerHeight),this.mount.appendChild(this.renderer.domElement),this.controls=new I.a(this.camera,this.renderer.domElement),this.interaction=new z.a(this.renderer,this.scene,this.camera);for(var t=[],a=[],r=0;r<this.props.jsonFile.rooms.length;r++){console.log("iiiii",this.props.jsonFile.rooms[r]);var n=new L.BoxGeometry(this.props.jsonFile.rooms[r].size.x,this.props.jsonFile.rooms[r].size.y,this.props.jsonFile.rooms[r].size.z),o=new L.Color(this.perc2color(this.props.jsonFile.rooms[r].roomAirflow)),s=new L.MeshLambertMaterial({color:o}),c=new L.LineSegments(new L.EdgesGeometry(n),new L.LineBasicMaterial({color:"#000000"}));t.push(new L.Mesh(n,s)),a.push(c)}for(var l=0;l<t.length;l++)t[l].position.set(this.props.jsonFile.rooms[l].position.x,this.props.jsonFile.rooms[l].position.y,this.props.jsonFile.rooms[l].position.z),a[l].position.set(this.props.jsonFile.rooms[l].position.x,this.props.jsonFile.rooms[l].position.y,this.props.jsonFile.rooms[l].position.z),t[l].Name=this.props.jsonFile.rooms[l].roomName,t[l].Number=this.props.jsonFile.rooms[l].roomNumber,t[l].Volume=this.props.jsonFile.rooms[l].roomVolume,t[l].Area=this.props.jsonFile.rooms[l].roomArea,t[l].AHU=this.props.jsonFile.rooms[l].roomAHU,t[l].Airflow=this.props.jsonFile.rooms[l].roomAirflow,t[l].roomID=this.props.jsonFile.rooms[l].id,t[l].cursor="pointer",t[l].on("click",(function(t){e.setState({popup:!e.state.popup,id:t.target.uuid,roomID:t.target.roomID,roomName:t.target.Name,roomNumber:t.target.Number,roomVolume:t.target.Volume,roomArea:t.target.Area,roomAHU:t.target.AHU,roomAirflow:t.target.Airflow},(function(){return console.log("state update:",e.state)}))})),this.scene.add(t[l]),this.scene.add(a[l]),console.log(this.scene);this.popup=!1,this.lightAmbient=new L.AmbientLight(16777215,.5),this.scene.add(this.lightAmbient),this.sunLight=new L.DirectionalLight(16777215,2,1e3),this.scene.add(this.sunLight),this.start()}},{key:"componentWillUnmount",value:function(){this.stop(),this.mount.removeChild(this.renderer.domElement)}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement("form",{className:"form-roomSubmit",onSubmit:this.handleSubmit},this.state.popup&&n.a.createElement(n.a.Fragment,null,n.a.createElement("div",{className:"popup",id:"exampleModalScrollable",tabIndex:"-1",role:"dialog","aria-labelledby":"exampleModalScrollableTitle","aria-hidden":"true"},n.a.createElement("div",{className:"modal-dialog modal-dialog-centered",role:"document"},n.a.createElement("div",{className:"modal-content"},n.a.createElement("div",{className:"modal-header"},n.a.createElement("h5",{className:"modal-title",id:"exampleModalCenterTitle"},this.state.roomName," ",this.state.roomNumber),n.a.createElement("button",{type:"button",onClick:function(){return e.closePopup()},className:"close","data-dismiss":"modal","aria-label":"Close"},n.a.createElement("span",{"aria-hidden":"true"},"\xd7"))),n.a.createElement("div",{className:"modal-body"},n.a.createElement("div",null,"Volume: ",this.state.roomVolume," m3"),n.a.createElement("div",null,"Area: ",this.state.roomArea," m3"),n.a.createElement("div",{className:"popup-input"},n.a.createElement("div",{className:"popup-changeableInput"}," AHU-VE ",this.state.roomAHU),n.a.createElement("input",{type:"number",name:"roomAHU",value:0===this.state.roomAHU?"":this.state.roomAHU,onChange:this.handleChange})),n.a.createElement("div",{className:"popup-input"},n.a.createElement("div",{className:"popup-changeableInput"},"Airflow ",this.state.roomAirflow," m3/h ")," ",n.a.createElement("input",{type:"number",name:"roomAirflow",value:0===this.state.roomAirflow?"":this.state.roomAirflow,onChange:this.handleChange}))),n.a.createElement("div",{className:"modal-footer"},n.a.createElement("button",{type:"submit",className:"btn btn-primary"},"Save changes"))))),n.a.createElement("div",{className:"transparent-background"})),n.a.createElement("div",{style:{width:"400px",height:"400px"},ref:function(t){e.mount=t}})))}}]),t}(r.Component),G=function(e){var t,a=Object(r.useState)("None"),o=Object(c.a)(a,2),s=o[0],i=o[1],m=Object(r.useState)({}),u=Object(c.a)(m,2),p=u[0],h=u[1],f=Object(r.useState)([]),j=Object(c.a)(f,2),b=j[0],g=j[1],E=Object(r.useState)({title:"",description:""}),w=Object(c.a)(E,2),v=w[0],O=w[1],N=Object(r.useState)({}),P=Object(c.a)(N,2),A=P[0],D=P[1];return Object(r.useEffect)((function(){d.a.get("/api/projects/".concat(e.user._id)).then((function(e){g(e.data),console.log(e.data)})),i("None")}),[]),console.log("Projects component render"),"None"===s?(console.log("user",e.user),n.a.createElement("div",null,n.a.createElement("div",{className:"row"},n.a.createElement(y,{projects:b,setDisplay:i,setOneProject:h}),n.a.createElement("div",{className:"col-10 projectScreen"})))):"Form"===s?n.a.createElement("div",null,n.a.createElement("div",{className:"row"},n.a.createElement(y,{projects:b,setDisplay:i,setOneProject:h}),n.a.createElement("div",{className:"col-10 projectScreen"},n.a.createElement(S,(t={setDisplay:i,createNewProject:v,setcreateNewProject:O},Object(l.a)(t,"setDisplay",i),Object(l.a)(t,"setProjects",g),Object(l.a)(t,"projects",b),Object(l.a)(t,"jsonFile",A),Object(l.a)(t,"setFile",D),Object(l.a)(t,"user",e.user),t))))):"oneProject"===s?n.a.createElement("div",null,n.a.createElement("div",{className:"row"},n.a.createElement(y,{projects:b,setDisplay:i,setOneProject:h}),n.a.createElement("div",{className:"col-10 projectScreen"},n.a.createElement("div",null," ",n.a.createElement("h1",null," ",p.title))))):"newProject"===s?n.a.createElement("div",null,n.a.createElement("div",{className:"row"},n.a.createElement(y,{projects:b,setDisplay:i,setOneProject:h}),n.a.createElement("div",{className:"col-10 projectScreen"},n.a.createElement(F,{setOneProject:h,project:b[b.length-1],jsonFile:A,setFile:D,setDisplay:i})))):"ThreeJS"===s?(console.log(p),n.a.createElement("div",null,n.a.createElement("div",{className:"row"},n.a.createElement(y,{projects:b,setDisplay:i,setOneProject:h}),n.a.createElement("div",{className:"col-10 projectScreen"},n.a.createElement(B,{projects:b,setOneProject:h,project:p,jsonFile:p.file?p.file:A,setProjects:g}))))):void 0},M=function(){return n.a.createElement("div",null,"Nope!")},V=function(e){var t=Object(r.useState)(e.user),a=Object(c.a)(t,2),o=a[0],s=a[1];return console.log(e.user),n.a.createElement("div",{className:"App"},n.a.createElement(O,{user:o,setUser:s}),n.a.createElement(g.d,null,n.a.createElement(g.b,{exact:!0,path:"/",component:M}),n.a.createElement(g.b,{exact:!0,path:"/signup",component:function(e){return n.a.createElement(f,Object.assign({setUser:s},e))}}),n.a.createElement(g.b,{exact:!0,path:"/login",component:function(e){return n.a.createElement(b,Object.assign({setUser:s},e))}}),n.a.createElement(g.b,{exact:!0,path:"/projects",component:function(e){return o?n.a.createElement(G,Object.assign({user:o},e)):n.a.createElement(g.a,{to:"/"})}})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));d.a.get("/api/auth/loggedin").then((function(e){var t=e.data;console.log(t),s.a.render(n.a.createElement(E.a,null,n.a.createElement(V,{user:t})),document.getElementById("root"))})),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[58,1,2]]]);
//# sourceMappingURL=main.6ccba98d.chunk.js.map